# shell-setup: Mutt

This [mutt](http://www.mutt.org/) configuration is a part of the entire
configuration suite named [shell-setup](https://github.com/nakal/shell-setup).
It is not meant to be run standalone.

[mutt](http://www.mutt.org/) is the default email client (MUA) for this
configuration. You can easily get it integrated to start within the
[xmonad configuration](https://github.com/nakal/xmonad-conf) by adding this
line to the host-specific configuration (in `autostartPrograms`):

```
("sh", ["-c", "'pgrep mutt || xterm -title mutt -e mutt'"])
```

To have mutt working properly together with GNUpg 2.1.x it is a good idea
to set the environment `GPG_AGENT_INFO` which has been deprecated in latest
releases. It will avoid being asked about the mantra two times and use the
pinentry backend, like it has been designed to work.

Usually the line below should be enough. I have put it in my
[~/.xinitrc](https://github.com/nakal/xmonad-conf/blob/master/xsettings/.xinitrc).

```
export GPG_AGENT_INFO="$HOME/.gnupg/S.gpg-agent:0:1"
```

## Local configuration

To use mutt, you still need a further configuration file in
`~/.mutt/local.muttrc` with the following entries that vary from host
to host.

```
set realname="My Full Name"
set from="My Full Name <my.email@server.org>"
set smtp_url="smtps://USERNAME:PASSWORD@smtp.server.org/"
set pgp_sign_as=WWXXYYZZ
[...]
```

## Mailboxes

In file `~/.mutt/add.mailboxes` there is a piece of script to fetch mailboxes
from a list generated by `offlineimap`. It looks like this:

```
mailboxes `cat ~/.mutt/muttrc.mailboxes | tr '\n' ' '`
```

You can also filter the mailbox list (after `cat`) with `egrep -v`, if you
want exclude some of them from `mutt`.

## Colors for mutt

The colorscheme for mutt is in `~/.mutt/colors.muttrc`. It mostly tries to
simulate the colors from atom-dark.

## OfflineIMAP

Here is a sample configuration for `offlineimap`. It generates the
list of mailboxes that can be consumed as shown above. It syncs
an IMAP account that you need to set up with a local maildir
in `~/.mail` (hidden directory).

```
[general]

accounts = MyCompany

[mbnames]

enabled = yes
filename = ~/.mutt/muttrc.mailboxes
header = ''
peritem = "+%(foldername)s"
sep = "\n"
footer = "\n"
incremental = no

[Account MyCompany]

localrepository = Local
remoterepository = Remote
autorefresh = 2

[Repository Local]

type = Maildir
localfolders = ~/.mail

[Repository Remote]

type = IMAP
remotehost = imap.mycompany.org
ssl = yes
#sslcacertfile = ~/.certs/myca.pem
remoteuser = myname
remotepass = mypassword

idlefolders = ['INBOX', 'FreeBSD', 'Logs', 'Notifications']
```

## Further features

* integrates vim as editor to write emails
* integrates GNUpg and GPG-Agent in a unannoying way
* integrates `abook`
* Trash is a trash folder, mails won't be simply deleted
* caching enabled
* safe HTML view of emails without losing all links
* some `mailcap` settings
* some special bindings
	* a few hacks for the sidebar patch
		* `Ctrl+Up` and `Ctrl+Down`  move the folder selection
		* `Ctrl+Right` selects the folder
	* `Ctrl+Backspace` goes back to INBOX
	* `Backslash` goes to a mailbox with unread mail
	* learning of spams and hams (the backend is not open source, sorry)
		* `X` moves the current mail to the folder `=LearnSpam`
		* `H` moves the current mail to the folder `=LearnHam`
